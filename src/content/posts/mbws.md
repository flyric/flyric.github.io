---
title: Möbius Inversion
published: 2025-12-23
description: 莫比乌斯反演算法介绍
tags: [算法, Demo]
category: ACM
draft: false
---

### 狄利克雷卷积

设 $f,g$ 是两个算术函数 $(f:\mathbb{N}\to\mathbb{C})$，  
它们的 **狄利克雷卷积** 定义为一个新的算术函数 $(f*g)$：

$$
(f * g)(n)=\sum_{d\mid n} f(d)\, g\!\left(\frac{n}{d}\right)
$$

也可以写成对所有正整数对 $(a,b)$ 满足 $ab=n$ 的求和：

$$
(f * g)(n)=\sum_{ab=n} f(a)g(b)
$$

---

### 狄利克雷“前缀和”

普通前缀和是：

$$
S(n)=\sum_{k\le n} f(k)
$$

而这里考虑的是：

$$
F(n)=\sum_{d\mid n} f(d)
$$

对比一下：

| 普通前缀和 | 狄利克雷“前缀和” |
|-----------|----------------|
| 索引：$(k\le n)$ | 索引：$(d\mid n)$ |
| 按大小顺序 | 按整除关系 |
| 加法半群 | 乘法半群 |

给定算术函数 $f$，定义

$$
F(n)=\sum_{d\mid n} f(d)
$$

很多人会把它称为：

**<div align="center">$f$ 的狄利克雷前缀和</div>**

因为它等价于：

$$
F = f * 1
$$

即与 **常数函数 $1$** 做狄利克雷卷积。

---

### 逆元

所谓逆元，是指在一个**带有二元运算**的集合 $(S,\circ)$ 中，  
若某个元素 $b$ 能够“抵消”元素 $a$ 的作用，则称 $b$ 为 $a$ 的逆元。

---

#### 逆元的一般定义

在一个带有二元运算的集合 $(S,\circ)$ 中：

##### 1. 单位元

存在元素 $e\in S$，满足

$$
\forall a\in S,\quad a\circ e=e\circ a=a
$$

##### 2. 结合律

$$
a\circ(b\circ c)=(a\circ b)\circ c
$$

##### 3. 逆元

若对某个 $a\in S$，存在 $b\in S$ 使得

$$
a\circ b=b\circ a=e
$$

则称：

- $b$ 是 $a$ 的 **逆元**
- 记作 $b=a^{-1}$

逆元若存在，则是唯一的。

---

### 狄利克雷卷积的性质

#### 交换律

$$
(f * g)(n)
=\sum_{ab=n} f(a)g(b)
=\sum_{ba=n} f(b)g(a)
=(g * f)(n)
$$

#### 结合律

$$
(f * g) * h = f * (g * h)
$$

（证明可由对三元因子分解 $abc=n$ 的求和交换顺序得到。）

#### 单位元

定义函数

$$
\varepsilon(n)=
\begin{cases}
1,& n=1\\
0,& n>1
\end{cases}
$$

则有

$$
f * \varepsilon = \varepsilon * f = f
$$

---

### 莫比乌斯反演

#### 它要解决什么问题？

> 已知
> $$
> F(n)=\sum_{d\mid n} f(d)
> $$
> 能否从 $F(n)$ **反推出 $f(n)$**？

这正是 **莫比乌斯反演** 要解决的问题。

---

引入 **莫比乌斯函数**

$$
\mu(n)=
\begin{cases}
1,& n=1\\
(-1)^k,& n\text{ 是 }k\text{ 个不同素数的乘积}\\
0,& n\text{ 含有平方因子}
\end{cases}
$$

它满足：

$$
\sum_{d\mid n} \mu(d)=
\begin{cases}
1,& n=1\\
0,& n>1
\end{cases}
$$

这等价于：

$$
1 * \mu = \varepsilon
$$

因此，**$\mu$ 是常数函数 $1$ 在狄利克雷卷积下的逆元**。

---

#### 莫比乌斯反演公式

若

$$
F(n)=\sum_{d\mid n} f(d)
$$

则

$$
f(n)=\sum_{d\mid n} \mu(d)\,F\!\left(\frac{n}{d}\right)
$$

这就是 **莫比乌斯反演公式**。

从卷积角度看：

$$
F = f * 1
$$

两边同时与 $\mu$ 卷积，得到：

$$
f = F * \mu
$$
### 由狄利克雷卷积的莫比乌斯反演推广得集合的莫比乌斯反演

#### 1. 将狄利克雷卷积的“端点硬编码”
>这里的‘端点硬编码’，指的是将上下界视为参数而非变量。

狄利克雷卷积定义为  

$$
(f*g)(t,n)=\sum_{d\mid n} f(d)\,g\!\left(\frac{n}{d}\right).
$$

现在我们**固定 $n,t$**，并把另一端也“硬编码”进函数中，定义  

$$
f'(d)=f(d),\qquad
g'(d)=g\!\left(\frac{n}{d}\right).
$$

于是  

$$
(f'*g')(n)=\sum_{d\mid n} f'(d)\,g'(d).
$$

这样写的关键在于：

- $n$ 是固定的“端点”
- $d$ 是唯一被枚举的“中间对象”
- $\frac{n}{d}$ 由 $d$ 唯一确定

这一结构已经非常接近集合偏序下的卷积形式。

---

#### 2. 集合包含偏序下的卷积形式

考虑偏序集  

$$
(\mathcal P(S),\subseteq).
$$

枚举所有满足  

$$
U\subseteq S
$$

的中间集合 $U$。

定义集合意义下的卷积：

$$
(f*g)(S)=
\sum_{U\subseteq S}
f(U)\,g(U,S).
$$

其结构与狄利克雷卷积**完全一致**。

---

#### 3. 集合情形下的“端点硬编码”

与整数情形固定 $n$ 类似，这里把 $S,T$ 全程固定，视作参数，定义  

$$
f'(U)=f(U),\qquad
g'(U)=g(U,S).
$$

则卷积退化为  

$$
(f'*g')(S)=
\sum_{ U\subseteq S}
f'(U)\,g'(U).
$$

此时：

- 端点被固定
- 只对“中间对象” $U$ 求和

---

#### 4. 统一视角下的对应关系

| 数论（整除偏序） | 集合（包含偏序） |
|---|---|
| 固定端点：$n$ | 固定端点：$T$ |
| 中间对象：$d\mid n$ | 中间对象：$U\subseteq S$ |
| $f'(d)=f(d)$ | $f'(U)=f(U)$ |
| $g'(d)=g(n/d)$ | $g'(U)=g(U,S)$ |
| 枚举因子 | 枚举中间集合 |
| 狄利克雷卷积 | 沿偏序求和 |

从这个角度看：

**狄利克雷卷积与集合卷积的差别只在偏序集不同，抽象结构完全一致。**

---

#### 5. 素数 ↔ 集合元素 的类比

在这一统一框架下，可以建立如下直观对应：

| 数论 | 集合 |
|---|---|
| 素数 | 基本元素 |
| 素因子分解 | 选择哪些元素 |
| 因子 $d\mid n$ | 子集 $U\subseteq S$ |
| 含平方因子 | 重复选择同一元素 |

因此：

- 一个整数的因子  
  ⇔ 从素因子集合中选出一部分  

- 一个集合的子集  
  ⇔ 从元素集合中选出一部分  

---

#### 6. 集合上的莫比乌斯函数

在集合包含偏序中，莫比乌斯函数具有显式形式：

$$
\mu(T,S)=
\begin{cases}
(-1)^{|S|-|T|}, & T\subseteq S,\\
0, & \text{otherwise}.
\end{cases}
$$

其含义是：

- 每个元素 **要么选，要么不选**
- 不允许“重复选择”（对应整数中的平方因子）

这与整数莫比乌斯函数的行为**完全一致**。

---

#### 7. 集合版莫比乌斯反演（容斥原理）

若  

$$
F(S)=\sum_{T\subseteq S} f(T),
$$

则可以反演得到  

$$
\begin{aligned}
f(S)
&=\sum_{T\subseteq S} \mu(T,S)\,F(T)\\
&=\sum_{T\subseteq S} (-1)^{|S|-|T|}\,F(T).
\end{aligned}
$$

这正是**容斥原理**的代数形式。

---

### 8. 本质总结

> **莫比乌斯反演的本质：  
> 是在偏序集上，对“前缀和”运算求逆。**

- 整数整除偏序 → 数论中的莫比乌斯反演  
- 集合包含偏序 → 容斥原理  
- 素数 ↔ 集合元素  

**狄利克雷卷积**只是这一抽象理论在**整数整除格**上的具体实现。

---

### 对于存在下界的形式

狄利克雷卷积的另一种表示形式是：

$$
(f * g)(m,n)=\sum_{d\mid n,\; m\mid d} f(m,d)\,g\!\left(\frac{n}{d},n\right)
$$

集合偏序下对应的卷积形式为：

$$
(f*g)(S,T)=
\sum_{T\subseteq U\subseteq S}
f(T,U)\,g(U,S).
$$

它们本质上只是**固定了卷积与反演过程中的端点**，  
通过重新定义函数即可统一到同一抽象框架之下。
